<html>

<head>

    <style>
        body {
            background-color: ivory;
        }

        #canvas {
            border: 1px solid red;
        }

        .tooltip {
            display: inline-block;
            position: fixed;
            padding: .5em 1em;
            background-color: #f1f1f1;
        }
    </style>
</head>

<body>
    <script>
        window.onload = function () {
            var canvas = document.getElementById("canvas");
            var ctx = canvas.getContext("2d");
            var cw = canvas.width;
            var ch = canvas.height;
            ctx.lineWidth = 2;
            ctx.font = '14px verdana';

            var PI2 = Math.PI * 2;
            var myColor = ["Green", "Red", "Blue"];
            var myData = [10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10];
            var pieColors = [];
            var defaultPieColors = [];
            initPieColors();
            var UNDEFINED = "undefiend!";
            var selectedColor = "#000000";

            var radius = 500;
            var cx = radius + 50;
            var cy = radius + 50;
            var wedgeLevelCount = 9;
            var radiusUnit = radius / wedgeLevelCount;
            var angleUnit = 15;
            var sweeps = []

            ctx.globalAlpha = 0.50;
            wedgeChart(myData, myColor);
            ctx.globalAlpha = 1.00;

            function initPieColors(){
                pieColors[8] = ['#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', ];
                pieColors[7] = ['#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', ];
                pieColors[6] = ['#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', ];
                pieColors[5] = ['#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', ];
                pieColors[4] = ['#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', ];
                pieColors[3] = ['#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', ];
                pieColors[2] = ['#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', ];
                pieColors[1] = ['#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', ];
                pieColors[0] = ['#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', ];

                defaultPieColors[8] = ['#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', '#8c0e5d', ];
                defaultPieColors[7] = ['#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', '#97065e', ];
                defaultPieColors[6] = ['#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', '#9a025b', ];
                defaultPieColors[5] = ['#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', '#a50779', ];
                defaultPieColors[4] = ['#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', '#9d0386', ];
                defaultPieColors[3] = ['#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', '#94068a', ];
                defaultPieColors[2] = ['#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', '#7e0787', ];
                defaultPieColors[1] = ['#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', '#620b73', ];
                defaultPieColors[0] = ['#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', '#330037', ];
            }

            function wedgeChart(data, colors) {
                // calc data total
                var total = 0;
                for (var i = 0; i < data.length; i++) {
                    total += data[i];
                }
                // calc sweep angles for each wedgece of wedge
                for (var i = 0; i < data.length; i++) {
                    sweeps.push(data[i] / total * PI2);
                }

                for (var k = wedgeLevelCount; k > 0; k--) {
                    var accumAngle = 0;
                    // for (var i = 0; i < sweeps.length; i++) {
                    for (var i = 0; i < sweeps.length; i++) {
                        var r = radiusUnit * k;
                        var f = pieColorAt(k, 1);
                        drawWedge(r, accumAngle, accumAngle + sweeps[i], f, data[i]);
                        accumAngle += sweeps[i];
                    }
                }
            }

            function drawPie(radiusIndex, angleIndex, fill, label){
                
                drawWedge(radiusIndex * radiusUnit, sweeps[0]*(sweeps.length -angleIndex - 1), sweeps[0] * (sweeps.length - angleIndex), fill, label);
                pieColors[radiusIndex-1][angleIndex] = fill;
                
                for (var k = radiusIndex - 1; k > 0; k--) {
                        var r = radiusUnit * k;
                        var f = pieColorAt(k, angleIndex);
                        drawWedge(r, sweeps[0]*(sweeps.length -angleIndex - 1), sweeps[0] * (sweeps.length - angleIndex), f, label);
                }
            }

            function drawWedge(radius, startAngle, endAngle, fill, label) {
                // draw the Wedge
                ctx.beginPath();
                ctx.moveTo(cx, cy);
                
                ctx.arc(cx, cy, radius, startAngle, endAngle, false);
                
                ctx.closePath();
                ctx.fillStyle = fill;
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.stroke();
            }

            function radiusNameOf(index){
                switch (index) {
                            case 1:
                                return 'core';
                                break;
                            case 2:
                                return 'B';
                                break;
                            case 3:
                                return 'C';
                                break;
                            case 4:
                                return 'D';
                                break;
                            case 5:
                                return 'E';
                                break;
                            case 6:
                                return 'F';
                                break;
                            case 7:
                                return 'G';
                                break;
                            case 8:
                                return 'H';
                                break;
                            case 9:
                                return 'I';
                                break;
                            default:
                                return UNDEFINED;
                                break;
                        }
            }

            function randomColor() {
                return ('#' + (Math.floor(Math.random() * 0x1000000) + 0x1000000).toString(16).substr(1));
            }



            function pieColorAt(radiusIndex, angleIndex) {
                return pieColors[radiusIndex -1][angleIndex];
            }

            document.addEventListener('mousemove', onMouseUpdate, false);
            function onMouseUpdate(e) {
                x = e.pageX;
                y = e.pageY;

                var radiusName = radiusNameOf(isPointWhichCircle(x, y));
                var angleName = sectorNameOf(isPointWhichSector(x, y));

                $("#log").text("pageX: " + x + ", pageY: " + y);
                $(".tooltip").css({
                    "left": x + 20,
                    "top": y - 50,
                });

                var tooltipContent = radiusName + " : " + angleName;
                if (radiusName == UNDEFINED)
                    tooltipContent = UNDEFINED;
                document.getElementById("tooltip").textContent = tooltipContent;
                if (tooltipContent == UNDEFINED)
                    $(".tooltip").css({
                        "visibility": 'hidden',
                    });
                else
                    $(".tooltip").css({
                        "visibility": 'visible',
                    });
            }

            document.addEventListener('click', dataPlotUpdate, false);
            function dataPlotUpdate(e) {
                x = e.pageX;
                y = e.pageY;

                var radiusIndex = isPointWhichCircle(x, y);
                var angleIndex = isPointWhichSector(x, y);

                var radiusName = radiusNameOf(radiusIndex);
                if(radiusName == UNDEFINED)
                    return;
                if(pieColorAt(radiusIndex, angleIndex) == selectedColor){
                    drawPie(radiusIndex, angleIndex, defaultPieColors[radiusIndex-1][angleIndex], 'aaa');
                }
                else{
                    drawPie(radiusIndex, angleIndex, selectedColor, 'aaa');
                }
                console.log(radiusIndex + "th radius: "+angleIndex+"th sector has been clicked!");
            }

            function toDegrees(rad) {
                return rad * 180 / Math.PI;
            }

            function sectorNameOf(index){
                if(index == 0)
                    return 360;
                return index * 15;
            }

            function isPointWhichSector(x, y) {
                var startAngle = 0;
                for (var i = 0; i < myData.length; i++) {
                    if (isPointInsideSector(startAngle, x, y)) {
                        return i;
                    } else {
                        startAngle += angleUnit;
                    }
                }
            }

            function isPointInsideSector(startAngle, x, y) {

                var endAngle = startAngle + angleUnit;
                let tempX = x - cx;
                let tempY = y - cy;

                let Angle = toDegrees(Math.atan(tempY / tempX));
                if (tempY >= 0 && tempX >= 0) {
                    Angle = 360 - Angle;
                } else if (tempY >= 0 && tempX <= 0) {
                    Angle = 180 - Angle;
                } else if (tempY <= 0 && tempX <= 0) {
                    Angle = 180 - Angle;
                } else if (tempY <= 0 && tempX >= 0) {
                    Angle = -Angle;
                }

                // console.log(Angle+" : "+startAngle+" : "+endAngle)
                if (
                    (Angle >= startAngle) &&
                    (Angle <= endAngle)
                )
                    return true;
                else
                    return false;
            }

            function isPointWhichCircle(x, y) {
                var tempRadius = radiusUnit;
                for (var i = 1; i <= wedgeLevelCount; i++) {
                    if (isPointInside(tempRadius, x, y)) {
                        return i;
                    } else {
                        tempRadius += radiusUnit;
                    }
                }
            }

            function isPointInside(radius, x, y, startAngle, endAngle) {

                // Calculate polar co-ordinates
                let tempX = x - cx;
                let tempY = y - cy;
                let polarradius = Math.sqrt(tempX * tempX + tempY * tempY);
                let Angle = Math.atan(tempY / tempX);

                // Check whether polarradius is
                // less then radius of circle
                // or not and Angle is between
                // startAngle and endAngle
                // or not
                if (
                    // (Angle >= startAngle) &&
                    // (Angle <= endAngle) &&
                    (polarradius < radius)
                )
                    return true;
                else
                    return false;
            }

        };
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <canvas id="canvas" width=1300 height=1100></canvas>
    <div id="tooltip" class="tooltip">I'm a tooltip!</div>

    <div>
</body>

</html>